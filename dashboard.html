<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>OnKit – Ishchi oyna</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css" />
  <script src="lang.js" defer></script>
</head>
<body>
  <header>
    <h2>📚 OnKit</h2>
    <button class="menu-btn" onclick="toggleMenu()">☰</button>
    <div class="menu" id="menu">
      <a href="#" onclick="setDarkMode()">🌙 Dark</a>
      <a href="#" onclick="setLightMode()">☀️ Light</a>
      <a href="#" onclick="openModal()">👤 <span id="profileText">Profil</span></a>
      <a href="#" id="logoutBtn" onclick="logout()">🚪 Log out</a>
      <a href="search.html" id="searchBtn">🔍 Qidiruv</a>
      <a href="#" onclick="chooseLanguage()">🌐 Language</a>
      <a href="#" id="inviteBtn" onclick="copyInvite()">👥 Do‘stlarni taklif qilish</a>
    </div>
  </header>

  <h3><span id="welcome">Assalomu alaykum,</span> <span id="username">Foydalanuvchi</span>!</h3>

  <div class="section">
    <h4 id="books">Tavsiya etilgan kitoblar</h4>
    <div class="book-card">
      <img src="https://via.placeholder.com/150x140" alt="Kitob rasmi">
      <p>O‘tkan kunlar</p>
    </div>
    <div class="book-card">
      <img src="https://via.placeholder.com/150x140" alt="Kitob rasmi">
      <p>Mehrobdan chayon</p>
    </div>
    <div class="book-card">
      <img src="https://via.placeholder.com/150x140" alt="Kitob rasmi">
      <p>Alkimyogar</p>
    </div>
  </div>

  <!-- PROFIL MODAL -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>👤 <span id="profileTitle">Profilingiz</span></h2>
      <div class="profile-image">
        <img id="preview" src="https://via.placeholder.com/150" alt="Profil rasmi">
        <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)">
      </div>
      <input type="text" placeholder="Ismingiz" id="nameInput"><br>
      <textarea placeholder="Bio..." id="bioInput"></textarea><br>
      <button id="saveBtn" onclick="saveProfile()">💾 Saqlash</button>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("onkit_user"));
    const logged = localStorage.getItem("onkit_logged_in");

    if (!user || logged !== "true") {
      alert("Avval tizimga kiring!");
      window.location.href = "login.html";
    } else {
      document.getElementById("username").textContent = user.username;
    }

    function setDarkMode() {
      document.body.classList.add("dark-mode");
    }

    function setLightMode() {
      document.body.classList.remove("dark-mode");
    }

    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    function openModal() {
      document.getElementById("nameInput").value = user.name || "";
      document.getElementById("bioInput").value = user.bio || "";
      document.getElementById("profileModal").style.display = "block";
    }

    function closeModal() {
      document.getElementById("profileModal").style.display = "none";
    }

    function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function () {
        document.getElementById("preview").src = reader.result;
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    function saveProfile() {
      user.name = document.getElementById("nameInput").value;
      user.bio = document.getElementById("bioInput").value;
      localStorage.setItem("onkit_user", JSON.stringify(user));
      alert("Profil saqlandi!");
      closeModal();
    }

    function logout() {
      localStorage.setItem("onkit_logged_in", "false");
      window.location.href = "login.html";
    }

    function copyInvite() {
      const text = "Salom do‘stim! Men o‘zbekcha va boshqa tillardagi kitoblar olamiga tushib qoldim. Menga qo‘shiling: " + window.location.origin;
      navigator.clipboard.writeText(text);
      alert("Taklif linki nusxalandi!");
    }

    function chooseLanguage() {
      const lang = prompt("Tilni tanlang: uz yoki en").toLowerCase();
      if (lang === "uz" || lang === "en") {
        setLanguage(lang);
      } else {
        alert("Faqat 'uz' yoki 'en' kiriting.");
      }
    }

    window.onclick = function (e) {
      if (e.target == document.getElementById("profileModal")) {
        closeModal();
      }
    };
  </script>
</body>
</html>
